<script>
// Clean up any existing listeners
document.removeEventListener('keydown', window.slideKeyHandler);

// Create new handler with proper cleanup
window.slideKeyHandler = function(event) {
    if (event.key === 'ArrowRight') {
        const nextBtn = document.getElementById('nextSlide');
        if (nextBtn) {
            nextBtn.click();
            event.stopImmediatePropagation();
            event.preventDefault();
        }
    } else if (event.key === 'ArrowLeft') {
        const prevBtn = document.getElementById('prevSlide');
        if (prevBtn) {
            prevBtn.click();
            event.stopImmediatePropagation();
            event.preventDefault();
        }
    }
};

// Add fresh listener with capture phase
document.addEventListener('keydown', window.slideKeyHandler, true);

// Clean up when page unloads
document.addEventListener('htmx:beforeSwap', function() {
    document.removeEventListener('keydown', window.slideKeyHandler, true);
}, {once: true});
</script>

<title hx-swap-oob="true">Pitchdeck</title>

<h1>Pitchdeck</h1>

<div id="slide">
    <img src="/static/png/Folie{{.CurrentSlideNumber}}.PNG" alt="Pitchdeck Foliennummer {{.CurrentSlideNumber}}">
</div>

<div class="slide-navigation">
    <button
    id="prevSlide"
    hx-get="/previousslide"
    hx-swap="innerHTML"
    hx-target="#slide"
    hx-trigger="click, keydown[key=='ArrowLeft'] from:document"
    >
        <
</button>

    <span id="pageNumber">{{.CurrentSlideNumber}}</span>

    <button
    id="nextSlide"
    hx-get="/nextslide"
    hx-swap="innerHTML"
    hx-target="#slide"
    hx-trigger="click, keydown[key=='ArrowRight'] from:document"
    >
        >
    </button>
</div>

<h2>Kommentare</h2>

<button
    hx-get="/newcomment"
    hx-swap="innerHTML"
    hx-target="#main"
>
    Neu
</button>

<div id="comments">

    {{range .Comments}}
        {{if eq .SlideNumber $.CurrentSlideNumber}}
            <h3>{{.Name}}</h3>
            <div>{{.Comment}}</div>
        {{end}}
    {{end}}
</div>
